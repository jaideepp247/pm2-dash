# pm2dash

> A lightweight, self-hosted web dashboard for PM2 — real-time logs, system stats, and process controls in one place.

**pm2dash** lets you open a browser, see all your PM2 processes, watch logs stream live, and monitor CPU/RAM/disk — no cloud account, no agents, no complex configuration. Just a single `users.json` file and you're ready.

---

## Screenshots

> Replace the image below with your actual screenshot file (for example `screenshot.png`) placed in the project root.

![pm2dash Screenshot](./screenshot.png)

---

## Features

* **Live log streaming** — tails stdout and stderr for every PM2 process simultaneously using `fs.watch`, zero polling delay
* **Both log streams** — stdout and stderr shown together, stderr highlighted in red with a stream badge on each line
* **System stats** — CPU load %, RAM used/total, and per-mount disk usage, all with animated progress bars updating every 3 seconds
* **Per-process stats** — CPU %, memory, uptime, restart count, and status indicator (online / stopped / errored) updating every 2 seconds
* **Process controls** — restart, stop, and delete any process directly from the UI
* **Log filtering** — filter by process (click any process card), by stream (stdout / stderr), or by free-text search
* **Authentication** — login page with bcrypt-hashed passwords, HttpOnly session cookies, and sliding session expiry
* **Per-user readonly mode** — read-only users see all stats and logs but have no control buttons; enforced server-side too
* **Auto-reconnecting WebSocket** — connection indicator in the header, reconnects automatically if the server restarts
* **Zero build step** — entire frontend is served as a single self-contained HTML page from `server.js`
* **Works on plain HTTP with IP addresses** — session token is embedded in the WebSocket URL to avoid browser cookie restrictions on non-hostname origins

---

## Requirements

* Node.js 16 or higher
* PM2 running as a daemon (`pm2 list` should work before starting pm2dash)

---

## Installation

```bash
# 1. Clone the repo
git clone https://github.com/jaideepp247/pm2dash.git
cd pm2dash

# 2. Install dependencies
npm install

# 3. Create your users
node setup.js

# 4. Start the dashboard
node server.js
```

Open **[http://your-server-ip:3099](http://your-server-ip:3099)** and log in.

---

## setup.js

The interactive setup wizard creates and manages `users.json`. Run it any time to add or update users.

```
  ╔══════════════════════════════╗
  ║   pm2dash — user setup       ║
  ╚══════════════════════════════╝

  Username: admin
  Password: ········
  Read-only? (cannot restart/stop/delete) (y/N): N
  Hashing password... done.
  ✓ User "admin" added as admin.

  Add another user? (y/N): y

  Username: viewer
  Password: ········
  Read-only? (y/N): y
  ✓ User "viewer" added as read-only.
```

Passwords are hashed with bcrypt (12 salt rounds) and never stored in plain text.

---

## users.json

Created by `setup.js`. You can also edit it manually — just make sure passwords are bcrypt hashed.

```json
[
  {
    "username": "admin",
    "passwordHash": "$2b$12$...",
    "readonly": false
  },
  {
    "username": "viewer",
    "passwordHash": "$2b$12$...",
    "readonly": true
  }
]
```

| Field          | Type    | Description                                                  |
| -------------- | ------- | ------------------------------------------------------------ |
| `username`     | string  | Login username                                               |
| `passwordHash` | string  | bcrypt hash generated by `setup.js`                          |
| `readonly`     | boolean | `true` = view-only (no restart/stop/delete), `false` = admin |

---

## Configuration

All config is via environment variables. You can set them inline or use a `.env` loader like `dotenv`.

| Variable            | Default | Description                                                  |
| ------------------- | ------- | ------------------------------------------------------------ |
| `PORT`              | `3099`  | HTTP port the dashboard listens on                           |
| `LOG_LINES`         | `200`   | Number of historical log lines loaded per process on connect |
| `SESSION_TTL_HOURS` | `24`    | Session lifetime in hours (sliding — refreshes on activity)  |

Example:

```bash
PORT=4000 LOG_LINES=500 SESSION_TTL_HOURS=48 node server.js
```

---

## Running under PM2

You can run pm2dash under PM2 itself — it will appear as a process in its own dashboard.

```bash
pm2 start server.js --name pm2dash
pm2 save
```

---

## How it works

```
Browser ──── HTTP GET / ────────────────► Express (auth check)
             ◄── HTML page (token embedded in JS) ──────────────

Browser ──── WS ws://host/?token=xxx ──► ws.Server
             auth: token looked up in sessions Map
             ◄── procs + log history ──────────────────────────

             ◄── live updates every 2s / 3s ─────────────────────
                 (pm2.list + systeminformation)

             ◄── live log lines (fs.watch on ~/.pm2/logs/*.log) ──
```

* **Auth:** Sessions are stored in memory as a `Map`. The session token is embedded directly in the served HTML page and passed as a WebSocket URL query param (`?token=`), which works reliably on plain HTTP connections to IP addresses where browsers may not send cookies on the WS upgrade request.
* **Log tailing:** `fs.watch` is used on each PM2 log file. When the file grows, only the new bytes are read (tracked by file size offset), parsed into lines, and broadcast to all connected clients. File rotation is handled by resetting the offset when the file shrinks.
* **PM2 connection:** Uses the `pm2` npm package's programmatic API to connect to the local PM2 daemon socket. Process list and monit data (CPU/mem) are polled every 2 seconds.
* **System stats:** `systeminformation` polls current CPU load, memory, and filesystem sizes every 3 seconds.

---

## Dependencies

| Package             | Purpose                                       |
| ------------------- | --------------------------------------------- |
| `express`           | HTTP server and routing                       |
| `ws`                | WebSocket server                              |
| `pm2`               | PM2 daemon API (process list, monit, actions) |
| `systeminformation` | CPU, RAM, and disk stats                      |
| `bcrypt`            | Password hashing for users.json               |

No frontend build tools, no bundlers, no frameworks — the entire UI is plain HTML/CSS/JS rendered server-side.

---

## Security notes

* Passwords are bcrypt-hashed with 12 salt rounds
* Sessions use `HttpOnly` cookies plus a URL token for WebSocket auth
* Read-only enforcement is done server-side — readonly users' action messages are silently ignored
* There is no HTTPS built in; it is strongly recommended to put pm2dash behind a reverse proxy (nginx, Caddy) with TLS if exposed beyond a private network

---

## License

MIT
